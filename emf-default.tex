%%% emf_generic.tex
%%% Pandoc template 
%%% Created by Eric M. Fink (https://github.com/EricMFink)

% ====================
% = Layout & Spacing =
% ====================
$if(fontsize)$
\documentclass[$fontsize$,letterpaper,twoside]{article}
$else$
\documentclass[11pt,letterpaper,twoside]{article}
$endif$

$if(geometry)$
\usepackage[$geometry$]{geometry}
$else$
\usepackage[hmarginratio=1:1,top=1in,bottom=.75in,left=1.5in,right=1.5in]{geometry}
$endif$

\usepackage{multicol}
\usepackage{setspace}
\usepackage{ragged2e}
\RaggedRight
\usepackage[none]{hyphenat}
$if(parindent)$
\setlength{\parindent}{$parindent$}
\setlength{\parskip}{0.5em}
$else$
\setlength{\parindent}{0em}
\setlength{\parskip}{1em}
$endif$
\raggedbottom
\setlength{\emergencystretch}{3em}
\usepackage{currfile}

% ===================
% = Language & Date =
% ===================

\usepackage[english]{babel}  
\usepackage{datetime}
\newdateformat{mydate}{\THEDAY-\monthname-\THEYEAR}

% ==================
% = Colors & Fonts =
% ==================

\usepackage[table]{xcolor}
\definecolor{OffBlack}{HTML}{191919}
\definecolor{Maroon}{HTML}{800000}
\definecolor{TarHeelBlue}{HTML}{4b9cd3}
\definecolor{HopkinsBlue}{HTML}{002D72}
\definecolor{RacingGreen}{HTML}{004225}

\usepackage{fontspec}
\setmainfont{Athelas}[Mapping=tex-text]
\setsansfont{Adelle Sans}[Mapping=tex-text]
\setmonofont[Scale=0.90]{LFT Etica Mono}

\usepackage{textcomp}
\usepackage{amssymb}
\usepackage[]{ccicons}
\usepackage{fontawesome5}

% =======================
% = Headers and Footers =
% =======================

\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyfoot[C]{}
\fancyfoot[R]{\tiny\texttt{Revised: \mydate\today}}
$if(path)$
\fancyfoot[L]{\tiny\texttt{$path$}}
$else$
\fancyfoot[L]{}
$endif$
$if(subtitle)$
\fancyhead[CE]{\small{$title$}}
\fancyhead[CO]{\small{$subtitle$}}
\fancyhead[LE]{\small{\thepage}}
\fancyhead[LO]{\small{}}
\fancyhead[RE]{\small{}}
\fancyhead[RO]{\small{\thepage}}
$else$
\fancyhead[C]{\small{$title$}}
\fancyhead[LE]{\small{\thepage}}
\fancyhead[LO]{\small{}}
\fancyhead[RE]{\small{}}
\fancyhead[RO]{\small{\thepage}}
$endif$

% =========
% = Lists =
% =========

\usepackage{enumitem}
\setlistdepth{6}
\setlist[1]{labelindent=.5em}
\setlist[itemize]{leftmargin=*}
\setlist[enumerate]{labelsep=*, leftmargin=2em}
\setlist{nosep}
\providecommand{\tightlist}{%
  \setlength{\topsep}{0em}\setlength{\partopsep}{0em}\setlength{\itemsep}{0em}\setlength{\parskip}{0em}}

% ============
% = Headings =
% ============

\usepackage[compact]{titlesec}
% \titlespacing*{<command>}{<left>}{<before-sep>}{<after-sep>}
\titlespacing*{\section}{0em}{2em}{.5em}
\titlespacing*{\subsection}{0em}{1.5em}{.5em}
\titlespacing*{\subsubsection}{0em}{1em}{.5em}
\titlespacing*{\paragraph}{0em}{.5em}{.2em}
\titlespacing*{\subparagraph}{0em}{.5em}{.2em}

$if(secnumdepth)$
\setcounter{secnumdepth}{$secnumdepth$}
$else$
\setcounter{secnumdepth}{0}
$endif$

\titleformat{\section}[hang]
  {\LARGE\sffamily\color{Maroon}}
  {\thesection}
  {1em}
  {}
\titleformat{\subsection}[hang]
  {\Large\sffamily\color{Maroon}}
  {\thesubsection}
  {1em}
  {}
\titleformat{\subsubsection}[hang]
  {\large\bfseries\rmfamily}
  {\thesubsubsection}
  {1em}
  {}
\titleformat{\paragraph}[hang]
  {\normalsize\bfseries\rmfamily}
  {\theparagraph}
  {1em}
  {}
\titleformat{\subparagraph}[hang]
  {\normalsize\itshape\rmfamily}
  {\thesubparagraph}
  {1em}
  {}

% ==========
% = Quotes =
% ==========

\usepackage{csquotes}
$if(fancyquote)$
\AtBeginEnvironment{quote}{\sffamily\small}
\renewenvironment{quote}{%
   \list{}{%
     \leftmargin2em   % this is the adjusting screw
     \rightmargin\leftmargin\parsep 0mm }
   \item\relax
}
{\endlist}
$else$
\AtBeginEnvironment{quote}{\small}
\renewenvironment{quote}{%
   \list{}{%
     \leftmargin2em   % this is the adjusting screw
     \rightmargin\leftmargin\parsep 0mm }
   \item\relax
}
{\endlist}
$endif$

% ==========
% = Tables =
% ==========

\usepackage{longtable,booktabs,array}
%\setlength\heavyrulewidth{0pt}
\usepackage{multirow}
\usepackage{calc}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\renewcommand{\arraystretch}{1.5}
\AtBeginEnvironment{longtable}{\footnotesize}

% ==============
% = Separators =
% ==============

\newcommand{\halfsep}{%
    \textcolor{Maroon}{\noindent\hfil\rule{.5\textwidth}{.5pt}\hfil} 
}

\newcommand*{\fullsep}{%
  \par
  \begingroup
    \centering
    \raisebox{.2\baselineskip}{%
      \textcolor{Maroon}{\rule{\linewidth}{2pt}}%
    }%
    \par
  \endgroup
}

% ==============
% = Blank Page =
% ==============

\usepackage{afterpage}
\newcommand\blankpage{%
    \null
    \thispagestyle{empty}%
    \addtocounter{page}{-2}%
    \newpage}

% ================
% = Title Layout =
% ================

\usepackage{titling}

% \setlength{\droptitle}{-3cm}
\title{$for(title)$\Large\textbf{$title$}$if(subtitle)$:\\ \textbf{$subtitle$} $endif$ $endfor$}
\author{$for(author)${$author$}$if(thanks)$ \thanks{$thanks$} $endif$ \\ $if(position)$ {$position$}\\$endif$ {$affiliation$}\\ $if(address)$ {$address$}$endif$ $endfor$}
\date{$date$}

% Aligns * for "thanks" footnote with left margin
\setlength\thanksmarkwidth{.5em}
\setlength\thanksmargin{-\thanksmarkwidth}

% ============
% = Graphics =
% ============

\usepackage[justification=centering,font={scriptsize},skip=1em]{caption}
% Sizes: scriptsize, footnotesize, small, normalsize, large, Large
\captionsetup[figure]{labelformat=empty,width=.8\linewidth}
\usepackage{float}
\let\origfigure\figure
\let\endorigfigure\endfigure
\renewenvironment{figure}[1][2] {
    \expandafter\origfigure\expandafter[H]
} {
    \endorigfigure
}

\usepackage[export]{adjustbox}% http://ctan.org/pkg/adjustbox
\let\oldincludegraphics\includegraphics
\renewcommand{\includegraphics}[2][]{%
  \oldincludegraphics[#1,max width=.75\linewidth]{#2}}

% =============
% = Footnotes = 
% =============

\usepackage[hang,flushmargin]{footmisc} 
$if(notesymbols)$\renewcommand{\thefootnote}{\fnsymbol{footnote}}$endif$

% ===================
% = Pandoc citeproc =
% ===================

$if(csl-refs)$
\NewDocumentCommand\citeproctext{}{}
\NewDocumentCommand\citeproc{mm}{%
\begingroup\def\citeproctext{#2}\cite{#1}\endgroup}
\makeatletter
\let\@cite@ofmt\@firstofone
\def\@biblabel#1{}
\def\@cite#1#2{{#1\if@tempswa , #2\fi}}
\makeatother
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newenvironment{CSLReferences}[2] % #1 hanging-indent, #2 entry-spacing
{\begin{list}{}{%
	\setlength{\itemindent}{0pt}
	\setlength{\leftmargin}{0pt}
	\setlength{\parsep}{0pt}
	\ifodd #1
	\setlength{\leftmargin}{\cslhangindent}
	\setlength{\itemindent}{-1\cslhangindent}
	\fi
	\setlength{\itemsep}{#2\baselineskip}}}
{\end{list}}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{\hfill\break\parbox[t]{\linewidth}{\strut\ignorespaces#1\strut}}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{\strut#1\strut}}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}
$endif$

% ==============
% = Hyperlinks =
% ==============

\usepackage[unicode=true]{hyperref}
\hypersetup{%
  colorlinks=true,
  allcolors=HopkinsBlue,
  breaklinks=true,
  pdfusetitle=true,
  pdfauthor={$author$},
  pdftitle={$title$},
  $if(subject)$
  pdfsubject={$subject$},
  $endif$
  $if(keywords)$
  pdfkeywords={$for(keywords)$$keywords$$sep$, $endfor$},
  $endif$
  pdfproducer=LateX via pandoc,
  pdfcreator=LateX via pandoc
}

% ==============================================================================
% =============================== BEGIN DOCUMENT ===============================
% ==============================================================================

\begin{document}
\color{OffBlack}
\singlespacing

$if(full-title)$
\maketitle

$else$

\thispagestyle{empty}
\begin{flushleft}

$if(subject)$
\small{$subject$} \\
$endif$

$if(author)$
\small{$author$} \\
$endif$

$if(affiliation)$
\small{$affiliation$}  \\
$endif$

$if(term)$
\small{$term$} \\
$endif$

$if(date)$
\small{$date$} \\
$endif$

$if(title)$
\vspace{5mm}
\sffamily\centering\LARGE\textbf{\color{Maroon}{$title$}}
$endif$

$if(subtitle)$
\vspace{2mm}
\sffamily\centering\Large{\color{Maroon}{$subtitle$}}
$endif$

\vspace{5mm}

\end{flushleft}

$endif$

$if(columns)$
\setlength{\columnsep}{3em}
\begin{multicols*}{2}
$body$
\end{multicols*}

$else$
$body$
$endif$

\end{document}